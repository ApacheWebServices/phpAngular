// Generated by CoffeeScript 1.8.0
var rssController;

rssReader.controller("rssController", rssController = function($scope, $http, $timeout, $location, feedService) {
  if ($scope.rssUrls == null) {
    $scope.rssUrls = [];
  }
  if ($scope.rssEntries == null) {
    $scope.rssEntries = [];
  }
  $scope.create = function() {
    return feedService.parseFeed($scope.rssUrl).success(function(response) {
      var entry, _i, _len, _ref, _results;
      if (response.responseData != null) {
        $scope.rssUrls.pushUnique($scope.rssUrl);
        _ref = response.responseData.feed.entries;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          entry = _ref[_i];
          _results.push($scope.rssEntries.pushUnique(entry, function(a, b) {
            return a.link === b.link;
          }));
        }
        return _results;
      } else {
        return alert(response.responseDetails);
      }
    });
  };
  $scope.destroy = function(index) {
    return $scope.rssUrls.splice(index, 1);
  };

  $scope.getData = function() {
    $http.get("rssfeeds/data")
        .success(function(response){
            var rssUrls = response;
            angular.forEach(rssUrls, function(value, key) {
               $scope.rssUrl = value;
               $scope.create();
            });
        });
  };

  return $scope.refresh = function() {
    return $scope.rssUrls.map(function(obj) {
      $scope.rssUrl = obj;
      return $scope.create();
    });
  };

});
